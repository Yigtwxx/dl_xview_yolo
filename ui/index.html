<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>DL XVIEW ‚Ä¢ G√∂r√ºnt√º Analiz Paneli</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    /* ========= RESET ========= */
    html,body{
      margin:0;
      height:100%;
      overflow:hidden;
      font-family:"Inter","Segoe UI",system-ui,sans-serif;
      background:#030712;
      color:#fff;
    }

    /* ========= ARKA PLAN SAHNESƒ∞ ========= */
    .bg {
      position: fixed;
      inset: 0;
      z-index: 0;
      background:
        radial-gradient(circle at 15% 5%, rgba(147, 197, 253, 0.25) 0%, rgba(3, 7, 18, 0) 45%),
        radial-gradient(circle at 82% 12%, rgba(254, 240, 138, 0.4) 0%, rgba(3, 7, 18, 0) 40%),
        linear-gradient(160deg, #071422 0%, #050b16 30%, #030712 75%, #020617 100%);
      overflow: hidden;
    }

    /* grid */
    .bg::before {
      content:"";
      position:absolute;
      inset:-40px;
      background-image:
        linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px),
        linear-gradient(0deg, rgba(255,255,255,0.02) 1px, transparent 1px);
      background-size: 80px 80px;
      transform: skewY(-6deg);
      filter: drop-shadow(0 0 15px rgba(0,0,0,0.3));
      opacity:.45;
      pointer-events:none;
    }

    /* soft ƒ±≈üƒ±k lekeleri */
    .bg-blur {
      position:absolute;
      inset:-10%;
      background:
        radial-gradient(circle, rgba(145,255,236,0.12) 0%, rgba(145,255,236,0) 50%),
        radial-gradient(circle at 70% 20%, rgba(40,140,255,0.08) 0%, rgba(40,140,255,0) 56%);
      filter: blur(60px);
      animation: blob-move 35s ease-in-out infinite;
      pointer-events:none;
    }
    .bg-blur.two { animation-duration: 46s; animation-direction: reverse; opacity:.6; }
    .bg-blur.three { animation-duration: 60s; opacity:.35; }

    @keyframes blob-move {
      0%   { transform: translate3d(var(--px,0), var(--py,0), 0) translate(0,0) scale(1); }
      50%  { transform: translate3d(var(--px,0), var(--py,0), 0) translate(4%,6%) scale(1.1); }
      100% { transform: translate3d(var(--px,0), var(--py,0), 0) translate(0,0) scale(1); }
    }

    /* parlayan √ßemberler */
    .ring {
      position:absolute;
      width:540px;
      height:540px;
      border:1px solid rgba(175, 243, 255, 0.24);
      border-radius:9999px;
      filter: drop-shadow(0 0 12px rgba(175,243,255,0.3));
      animation: ring-pulse 14s ease-in-out infinite;
      pointer-events:none;
    }
    .ring.r1 { top:-180px; right:-120px; }
    .ring.r2 { bottom:-240px; left:-160px; animation-delay:-4s; transform:rotate(12deg); }
    .ring.r3 { top:40%; left:50%; transform:translateX(-50%) rotate(-18deg); width:460px; height:460px; opacity:.35; }

    @keyframes ring-pulse {
      0%,100% { opacity:.25; transform: translate3d(var(--px,0), var(--py,0), 0) translateY(0) scale(1) rotate(0.2deg); }
      50%     { opacity:.65; transform: translate3d(var(--px,0), var(--py,0), 0) translateY(8px) scale(1.03) rotate(-0.2deg); }
    }

    /* yatay ƒ±≈üƒ±k ≈üeritleri */
    .line {
      position:absolute;
      left:-15%;
      right:-15%;
      height:2px;
      background:linear-gradient(90deg, rgba(0,0,0,0) 0%, rgba(184,242,255,1) 45%, rgba(0,0,0,0) 100%);
      filter:drop-shadow(0 0 10px rgba(168,236,255,0.6));
      opacity:.25;
      animation: line-move 12s linear infinite;
      pointer-events:none;
    }
    .line.l1 { top:18%; }
    .line.l2 { top:46%; animation-delay:-3s; opacity:.35; }
    .line.l3 { top:74%; animation-delay:-6s; opacity:.18; }

    @keyframes line-move {
      0% { transform: translate3d(var(--px,0), var(--py,0), 0) translateX(-6%); }
      100% { transform: translate3d(var(--px,0), var(--py,0), 0) translateX(6%); }
    }

    /* ======= DYNAMIC SKY LAYERS ======= */
    .stars{ position:absolute; inset:-6%; pointer-events:none; opacity:.35; will-change:transform;
      background-image:
        radial-gradient(1px 1px at 12% 18%, rgba(255,255,255,.8) 99%, rgba(0,0,0,0) 100%),
        radial-gradient(1.2px 1.2px at 44% 8%, rgba(255,255,255,.65) 99%, rgba(0,0,0,0) 100%),
        radial-gradient(0.8px 0.8px at 78% 26%, rgba(255,255,255,.75) 99%, rgba(0,0,0,0) 100%),
        radial-gradient(1.1px 1.1px at 22% 74%, rgba(255,255,255,.7) 99%, rgba(0,0,0,0) 100%),
        radial-gradient(0.9px 0.9px at 66% 86%, rgba(255,255,255,.85) 99%, rgba(0,0,0,0) 100%);
      background-size: 600px 600px, 520px 520px, 680px 680px, 560px 560px, 720px 720px;
      animation: star-drift 60s linear infinite;
      will-change: background-position, opacity;
    }
    .stars.two{ opacity:.22; filter:blur(.3px); animation-duration: 90s; }
    @keyframes star-drift{
      0% { background-position: 0 0, 0 0, 0 0, 0 0, 0 0; }
      100% { background-position: 200px -120px, -160px 120px, 220px 160px, -120px -160px, 180px -220px; }
    }

    .aurora{ position:absolute; inset:-20%; pointer-events:none; opacity:.36; filter: blur(42px) saturate(1.1); mix-blend-mode: screen; will-change:transform;}
    .aurora.a1{ background: conic-gradient(from 180deg at 40% 30%, rgba(69,255,210,0.0), rgba(69,255,210,.35), rgba(0,153,255,.25), rgba(255,255,255,0.0) 75%);
      animation: aurora-sweep 26s ease-in-out infinite; }
    .aurora.a2{ background: conic-gradient(from 0deg at 60% 70%, rgba(0,153,255,0.0), rgba(0,153,255,.28), rgba(146, 255, 236,.22), rgba(255,255,255,0.0) 80%);
      animation: aurora-sweep-2 34s ease-in-out infinite; opacity:.28; }
    @keyframes aurora-sweep{
      0%,100% { transform: translate3d(var(--px,0), var(--py,0), 0) translate(-2%, 0%) rotate(-3deg) scale(1.05); }
      50% { transform: translate3d(var(--px,0), var(--py,0), 0) translate(2%, 1%) rotate(3deg) scale(1.08); }
    }
    @keyframes aurora-sweep-2{
      0%,100% { transform: translate3d(var(--px,0), var(--py,0), 0) translate(2%, -1%) rotate(4deg) scale(1.04); }
      50% { transform: translate3d(var(--px,0), var(--py,0), 0) translate(-2%, 2%) rotate(-4deg) scale(1.07); }
    }

    .grain{ position:absolute; inset:-12%; pointer-events:none; opacity:.12; will-change:transform;
      background: repeating-conic-gradient(from 0deg, rgba(255,255,255,0.02) 0 0.25deg, rgba(0,0,0,0.02) 0.25deg 0.5deg);
      animation: grain-rot 18s linear infinite; filter: contrast(1.1) saturate(1.05) blur(.3px);
    }
    @keyframes grain-rot{ to { transform: translate3d(var(--px,0), var(--py,0), 0) rotate(360deg); } }

    /* saƒü √ºst g√ºne≈ü */
    .sun {
      position:absolute;
      top:-110px;
      right:-110px;
      width:300px;
      height:300px;
      background:radial-gradient(circle, rgba(255,255,255,0.8) 0%, rgba(255,204,143,0) 75%);
      filter:blur(2px);
      animation: sunPulse 8s ease-in-out infinite;
      pointer-events:none;
      opacity:.95;
    }
    @keyframes sunPulse {
      0%,100% { transform: translate3d(var(--px,0), var(--py,0), 0) scale(1); opacity:.95; }
      50% { transform: translate3d(var(--px,0), var(--py,0), 0) scale(1.1); opacity:.7; }
    }

    /* ========= √ñN PLAN (panel) ========= */
    main{
      position:relative;
      z-index:10;
      display:flex;
      flex-direction:column;
      justify-content:center;
      align-items:center;
      height:100%;
    }

    /* ========= ENTERPRISE TOUCH-UPS (non-structural) ========= */
    :root{
      --accent-1:#00ffaa;
      --accent-2:#0099ff;
      --panel-bg:rgba(4,9,21,0.55);
      --panel-stroke:rgba(255,255,255,0.08);
      --text-weak:rgba(255,255,255,0.65);
      --text-faint:rgba(255,255,255,0.42);
    }

    /* Better glass depth + premium gradient border (no -webkit-mask) */
    .glass-panel{
      position:relative;
      isolation:isolate;
      border-radius:20px;
      /* Gradient border via dual backgrounds */
      border:1px solid transparent;
      background-image:
        linear-gradient(var(--panel-bg), var(--panel-bg)),
        linear-gradient(120deg,var(--accent-1), rgba(255,255,255,0.12), var(--accent-2));
      background-origin:border-box;
      background-clip:padding-box, border-box;
      box-shadow:
        0 18px 60px rgba(0,0,0,0.38),
        0 2px 0 rgba(255,255,255,0.04) inset;
      max-width: 920px;
      padding:2rem 2.4rem 1.6rem;
      width:90%;
      text-align:center;
      animation:fadeIn 1.1s ease;
      backdrop-filter:blur(18px);
    }
    .glass-panel::after{
      content:"";
      position:absolute;
      inset:0;
      border-radius:inherit;
      background:radial-gradient(1200px 180px at 50% -60px, rgba(0,255,213,0.15), rgba(0,0,0,0));
      filter:blur(18px);
      opacity:.35;
      pointer-events:none;
      z-index:-1;
    }

    @keyframes fadeIn{
      from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);}
    }

    h1{
      font-size:1.9rem;
      font-weight:700;
      margin:0 0 .6rem 0;
      background:linear-gradient(270deg,#ffffff,#bfe7ff,#7fffe5,#ffe69f,#ffffff);
      background-size:400% 400%;
      background-clip:text; -webkit-background-clip:text;
      color:transparent; -webkit-text-fill-color:transparent;
      animation:gradientFlow 6s ease infinite;
      letter-spacing:.02em;
    }
    @keyframes gradientFlow{ 0%{background-position:0% 50%;} 50%{background-position:100% 50%;} 100%{background-position:0% 50%;} }
    p.sub{ font-size:.9rem; color:var(--text-weak); margin-bottom:1.2rem; }

    /* dropzone */
    .dropzone{
      border:2px dashed rgba(0,255,213,.5);
      border-radius:14px;
      padding:1.8rem 1.5rem;
      background:radial-gradient(circle, rgba(0,255,213,.04) 0%, rgba(0,255,213,0) 65%), rgba(3,7,18,.05);
      cursor:pointer; transition:.25s ease; position:relative; overflow:hidden;
    }
    .dropzone::after{ content:""; position:absolute; inset:-35% -5%; background:radial-gradient(circle, rgba(255,255,255,0.25) 0%, rgba(255,255,255,0) 70%); opacity:0; transition:.25s ease; }
    .dropzone::before{ content:""; position:absolute; inset:-1px; border-radius:inherit; background:linear-gradient(135deg, rgba(0,255,213,0), rgba(0,255,213,.25) 35%, rgba(0,153,255,.28) 65%, rgba(0,153,255,0)); background-size:200% 100%; transform:translateZ(0); opacity:0; transition:opacity .25s ease; pointer-events:none; }
    .dropzone:hover{ background:rgba(0,255,213,.08); border-color:rgba(0,255,213,.88); }
    .dropzone:hover::after{ opacity:.5; }
    .dropzone:hover::before{ opacity:.45; }
    .dropzone.dragover{ border-color:var(--accent-1); box-shadow:0 0 0 3px rgba(0,255,213,.15) inset, 0 10px 26px rgba(0,255,213,.18); }
    .dropzone.dragover::before{ opacity:.75; animation:dz-scan 1.8s linear infinite; }
    @keyframes dz-scan{ 0%{background-position:0% 50%;} 100%{background-position:200% 50%;} }

    /* button */
    .btn{ margin-top:1.2rem; background:linear-gradient(115deg,var(--accent-1),var(--accent-2)); border:none; border-radius:999px; padding:.8rem 1.6rem; color:#031a15; font-weight:600; cursor:pointer; font-size:.9rem; transition:.2s; box-shadow:0 8px 28px rgba(0,255,213,.35), 0 1px 0 rgba(255,255,255,0.18) inset; }
    .btn:hover{ transform:translateY(-2px); filter:saturate(1.05); }
    .btn:active{ transform:translateY(0); filter:saturate(0.98); box-shadow:0 6px 18px rgba(0,255,213,.28); }
    .btn:disabled{ opacity:.55; cursor:not-allowed; transform:none; box-shadow:none; }
    .btn:focus-visible{ outline:none; box-shadow:0 0 0 3px rgba(255,255,255,0.14), 0 0 0 6px rgba(0,255,213,.25), 0 10px 28px rgba(0,255,213,.3); }

    /* preview */
    .preview{ margin-top:1.4rem; display:flex; justify-content:center; flex-wrap:wrap; gap:10px; }
    .preview-card{ background:rgba(0,0,0,.5); border-radius:12px; overflow:hidden; width:520px; max-width:100%; box-shadow:0 6px 20px rgba(0,0,0,.6); animation:fadeIn .6s ease; border:1px solid rgba(255,255,255,0.04); transition:transform .25s ease, box-shadow .25s ease; }
    .preview-card:hover{ transform:translateY(-2px); box-shadow:0 10px 28px rgba(0,0,0,.7); }
    .preview-card img{ width:100%; display:block; }
    @media (min-width:1200px){ .preview-card{ width:640px; } }

    /* log */
    .log{ font-size:.8rem; color:rgba(255,255,255,.82); text-align:left; margin-top:1rem; max-height:100px; overflow-y:auto; }
    .log::-webkit-scrollbar{height:8px;width:8px;}
    .log::-webkit-scrollbar-thumb{background:linear-gradient(180deg, rgba(0,255,213,.45), rgba(0,153,255,.45)); border-radius:20px;}
    .log::-webkit-scrollbar-track{background:rgba(255,255,255,0.05); border-radius:20px;}

    footer{ text-align:center; font-size:.75rem; color:rgba(255,255,255,.4); margin-top:1.4rem; text-shadow:0 6px 16px rgba(0,0,0,0.5); }

    /* k√º√ß√ºk ekran */
    @media(max-width:600px){
      .glass-panel{padding:1.5rem 1.1rem 1.1rem;}
      h1{font-size:1.45rem;}
      .preview-card{width:100%;}
      body{overflow-y:auto;}
      .ring{opacity:.12;}
      .line{opacity:.12;}
      .stars{opacity:.18;}
      .aurora{opacity:.22;}
    }

    /* System-friendly: reduce motion if user prefers */
    @media (prefers-reduced-motion: reduce){ *{animation:none!important; transition:none!important;} }
    /* Selection color */
    ::selection{background:rgba(0,255,213,.25);} ::-moz-selection{background:rgba(0,255,213,.25);} 

    /* Particle canvas */
    .particles{ position:absolute; inset:0; pointer-events:none; z-index:0; opacity:.6; }
  </style>
</head>
<body>
  <!-- ARKA PLAN -->
  <div class="bg">
    <canvas class="particles" id="particles"></canvas>
    <div class="stars" data-depth="0.015"></div>
    <div class="stars two" data-depth="0.02"></div>
    <div class="aurora a1" data-depth="0.04"></div>
    <div class="aurora a2" data-depth="0.06"></div>
    <div class="sun" data-depth="0.02"></div>
    <div class="bg-blur" data-depth="0.03"></div>
    <div class="bg-blur two" data-depth="0.035"></div>
    <div class="bg-blur three" data-depth="0.04"></div>
    <div class="ring r1" data-depth="0.03"></div>
    <div class="ring r2" data-depth="0.035"></div>
    <div class="ring r3" data-depth="0.025"></div>
    <div class="line l1" data-depth="0.018"></div>
    <div class="line l2" data-depth="0.02"></div>
    <div class="line l3" data-depth="0.022"></div>
    <div class="grain" data-depth="0.006"></div>
  </div>

  <!-- PANEL -->
  <main>
    <div class="glass-panel">
      <h1>üåç DL XVIEW G√∂r√ºnt√º Analiz Paneli</h1>
      <p class="sub">UYDU / UAV / TIFF / JPG g√∂r√ºnt√ºlerini y√ºkle</p>

      <div class="dropzone" id="dropzone">
        <p><strong>Dosya bƒ±rak ya da tƒ±kla</strong></p>
        <p style="font-size:.8rem;color:rgba(255,255,255,.6)">Model otomatik i≈ülenecek</p>
        <input type="file" id="file-input" accept="image/*" hidden />
      </div>

      <button class="btn" id="send-btn" disabled>G√∂nder</button>
      <div class="preview" id="preview"></div>
      <div class="log" id="log"></div>
    </div>
    <footer>Fƒ±rat √úni ‚Ä¢ YOLOv8/11 Tabanlƒ± XVIEW Sistemi</footer>
  </main>

  <!-- UPLOAD, PARALLAX & PARTICLES -->
  <script>
    const dropzone = document.getElementById("dropzone");
    const fileInput = document.getElementById("file-input");
    const sendBtn = document.getElementById("send-btn");
    const previewEl = document.getElementById("preview");
    const logEl = document.getElementById("log");
    let selectedFile = null;

    function log(msg){
      const now = new Date().toLocaleTimeString("tr-TR",{hour12:false});
      const row = document.createElement("div");
      row.textContent = `üïí ${now} ‚Äî ${msg}`;
      logEl.appendChild(row);
      logEl.scrollTop = logEl.scrollHeight;
    }

    dropzone.addEventListener("click", ()=>fileInput.click());
    dropzone.addEventListener("dragover", e=>{e.preventDefault();dropzone.classList.add("dragover");});
    dropzone.addEventListener("dragleave", e=>{e.preventDefault();dropzone.classList.remove("dragover");});
    dropzone.addEventListener("drop", e=>{
      e.preventDefault();
      dropzone.classList.remove("dragover");
      const file = e.dataTransfer && e.dataTransfer.files && e.dataTransfer.files[0];
      if(!file){ log("Ge√ßersiz bƒ±rakma: dosya bulunamadƒ±."); return; }
      if(!(file.type && file.type.startsWith("image/")) && !/\.(tif|tiff)$/i.test(file.name)){
        log("Sadece g√∂rsel dosyalarƒ± desteklenir.");
        return;
      }
      selectedFile = file;
      sendBtn.disabled = false;
      log("Dosya se√ßildi: " + selectedFile.name + " (" + (selectedFile.size/1024).toFixed(1) + " KB)");
    });

    fileInput.addEventListener("change", e=>{
      const f = e.target.files && e.target.files[0];
      if(!f) return;
      if(!(f.type && f.type.startsWith("image/")) && !/\.(tif|tiff)$/i.test(f.name)){
        log("Sadece g√∂rsel dosyalarƒ± desteklenir.");
        e.target.value = ""; // reset
        return;
      }
      selectedFile = f;
      sendBtn.disabled = false;
      log("Dosya se√ßildi: " + selectedFile.name + " (" + (selectedFile.size/1024).toFixed(1) + " KB)");
    });

    sendBtn.addEventListener("click", async ()=>{
      if (!selectedFile) return;
      sendBtn.disabled = true;
      sendBtn.textContent = "Y√ºkleniyor...";
      log("Sunucuya g√∂nderiliyor...");

      const formData = new FormData();
      formData.append("file", selectedFile);
      try {
        const res = await fetch("/predict", {method:"POST", body:formData});
        const type = res.headers.get("content-type") || "";
        if (!res.ok){
          const errText = await res.text().catch(()=>"");
          throw new Error(`Sunucu hatasƒ± ${res.status}: ${errText.slice(0,120)}`);
        }
        if (type.includes("application/json")){
          const data = await res.json();
          if (data.image_url) {
            renderPreview(data.image_url);
          } else {
            renderPreview(URL.createObjectURL(selectedFile), selectedFile.type);
          }
          log("‚úÖ JSON yanƒ±t alƒ±ndƒ±.");
        } else if (type.startsWith("image/")) {
          const blob = await res.blob();
          const url = URL.createObjectURL(blob);
          renderPreview(url, blob.type);
          log("‚úÖ G√∂rsel alƒ±ndƒ±.");
        } else {
          const text = await res.text();
          log("Beklenmeyen i√ßerik t√ºr√º: " + type + ". √ñzet: " + text.slice(0,120));
        }
      } catch(err){
        log("‚ùå Hata: " + err.message);
      } finally {
        sendBtn.disabled = false;
        sendBtn.textContent = "G√∂nder";
      }
    });

    function renderPreview(url, mime){
      const card = document.createElement("div");
      card.className = "preview-card";
      const isTiff = (mime && /image\/tiff/i.test(mime)) || /\.(tif|tiff)(\?.*)?$/i.test(url);
      if(isTiff){
        const a = document.createElement("a");
        a.href = url;
        a.textContent = "TIFF indir / yeni sekmede a√ß";
        a.target = "_blank";
        a.rel = "noopener";
        a.style.display = "block";
        a.style.padding = "1rem";
        card.appendChild(a);
      } else {
        const img = document.createElement("img");
        img.src = url;
        img.alt = "√áƒ±ktƒ±";
        img.style.display = "block";
        img.style.width = "100%";
        card.appendChild(img);
      }
      previewEl.innerHTML = "";
      previewEl.appendChild(card);
    }

    // ===== Parallax + Particles =====
    (function(){
      const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
      const isCoarse = matchMedia && matchMedia('(pointer: coarse)').matches;
      const bg = document.querySelector('.bg');
      const targets = Array.from(bg.querySelectorAll('[data-depth]'))
        .map(el=>({ el, depth: parseFloat(el.getAttribute('data-depth')) || 0 }));
      let w = window.innerWidth, h = window.innerHeight;
      let cx = w/2, cy = h/2;
      let mx = 0, my = 0; // last pointer
      let tx = 0, ty = 0; // smoothed pointer
      let rafId = 0;

      function onResize(){ w = window.innerWidth; h = window.innerHeight; cx = w/2; cy = h/2; resizeCanvas(); }
      window.addEventListener('resize', onResize);

      function onMove(e){
        const x = (e.clientX != null) ? e.clientX : cx;
        const y = (e.clientY != null) ? e.clientY : cy;
        mx = (x - cx) / cx; // -1..1
        my = (y - cy) / cy; // -1..1
      }
      if(!prefersReduced && !isCoarse){
        window.addEventListener('pointermove', onMove);
      }

      function tick(){
        // ease pointer
        tx += (mx - tx) * 0.06;
        ty += (my - ty) * 0.06;
        if(!prefersReduced && !isCoarse){
          for(const {el, depth} of targets){
            const dx = (tx * depth * 30).toFixed(2) + 'px';
            const dy = (ty * depth * 30).toFixed(2) + 'px';
            el.style.setProperty('--px', dx);
            el.style.setProperty('--py', dy);
          }
        }
        drawParticles();
        rafId = requestAnimationFrame(tick);
      }
      rafId = requestAnimationFrame(tick);
      window.addEventListener('blur', ()=>{ mx = my = tx = ty = 0; });

      // Particles (cinematic starfield)
      const cvs = document.getElementById('particles');
      const ctx = cvs.getContext('2d');
      let DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
      let particles = [];
      function resizeCanvas(){
        const rect = bg.getBoundingClientRect();
        cvs.width = Math.floor(rect.width * DPR);
        cvs.height = Math.floor(rect.height * DPR);
        cvs.style.width = rect.width + 'px';
        cvs.style.height = rect.height + 'px';
        ctx.setTransform(1,0,0,1,0,0);
        ctx.scale(DPR, DPR);
        initParticles(rect.width, rect.height);
      }
      function initParticles(w, h){
        const density = Math.min(90, Math.floor((w*h)/35000));
        particles = new Array(density).fill(0).map(()=>({
          x: Math.random()*w,
          y: Math.random()*h,
          r: 0.6 + Math.random()*1.4,
          a: 0.25 + Math.random()*0.55,
          vx: 0.04 + Math.random()*0.12,
          vy: -0.02 + Math.random()*0.08,
        }));
      }
      function drawParticles(){
        if(!ctx) return;
        const rect = bg.getBoundingClientRect();
        const wcss = rect.width; const hcss = rect.height;
        ctx.clearRect(0,0,wcss, hcss);
        if(prefersReduced) return;
        ctx.globalCompositeOperation = 'lighter';
        for(const p of particles){
          p.x += p.vx; p.y += p.vy;
          if(p.x > wcss+8) p.x = -8;
          if(p.y > hcss+8) p.y = -8;
          if(p.x < -8) p.x = wcss+8;
          if(p.y < -8) p.y = hcss+8;
          const grd = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.r*3);
          grd.addColorStop(0, `rgba(146,255,236,${p.a})`);
          grd.addColorStop(1, 'rgba(146,255,236,0)');
          ctx.fillStyle = grd;
          ctx.beginPath(); ctx.arc(p.x, p.y, p.r, 0, Math.PI*2); ctx.fill();
        }
        ctx.globalCompositeOperation = 'source-over';
      }
      resizeCanvas();
    })();
  </script>
</body>
</html>
